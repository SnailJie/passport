{% extends "auth/base.html" %}

{% block title %}注册{% endblock %}

{% block container %}
	<form action="" class="form">
		<div class="form-head">
			<h2>新用户注册</h2>
			<!--<p class="form-notice">注册即送888元礼包，还可享3折套餐优惠</p>-->
			<p>已有账号？<a href="{{ url_for('signIn') }}">立即登录</a></p>
		</div>
		<div class="form-body">
            {%- with messages = get_flashed_messages() %}
            {%- if messages %}
            <p class="err-msg">{{ " ".join(messages) }}</p>
            {%- endif %}
            {%- endwith %}
			<div class="ui-input">
				<input type="text" placeholder="手机号">
			</div>
			<div class="ui-input narrow-input">
				<input type="text" placeholder="短信验证码">
				<a class="sms-button" href="javascript:">获取验证码</a>
			</div>
			<div class="ui-input">
				<input type="password" placeholder="密码，6-16位，区分大小写">
			</div>
            <div id="vaptcha_container">
                <div class="vaptcha-init-loading">
                    <a><img src="{{ url_for('static', filename='images/vaptcha-loading.gif') }}"/></a>
                    <span class="vaptcha-text">VAPTCHA启动中...</span>
                </div>
            </div>
			<button class="ui-button ui-button--primary" disabled="disabled" id="signUpButton">注册</button>
		</div>
	</form>
{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
<script src="https://cdn.vaptcha.com/v.js"></script>
<script type="text/javascript">
    //这里使用到验证场景，传过去的参数即为对应的编号，比如之前登录的对应的编号即为01
    $.get('/getVaptcha?sceneid=02', function(res){
        console.log(res);
        var options={
            vid: res.vid, //验证单元id, string, 必填
            challenge: res.challenge, //验证流水号, string, 必填
            container:"#vaptcha_container",//验证码容器, HTMLElement或者selector, 必填
            type:"click", //必填，表示点击式验证模式,
            effect:'popup', //验证图显示方式, string, 可选择float, popup, 默认float
            color:"#57ABFF", //按钮颜色, string
            outage:"/getDowTime", //服务器端配置的宕机模式接口地址
            success:function(token,challenge){//验证成功回调函数, 参数token, challenge 为string, 必填
                //todo:执行人机验证成功后的操作
                console.log(token,challenge);
                $('#signUpButton').removeAttr("disabled");
                $('#signUpButton').removeClass("ui-button--primary");
                $('#signUpButton').addClass("ui-button--success");
            },
            fail:function(){//验证失败回调函数  
                //todo:执行人机验证失败后的操作
            }
        }
        var obj;
        window.vaptcha(options,function(vaptcha_obj){
            obj = vaptcha_obj;
            obj.init();
        });
    });
</script>
{% endblock %}